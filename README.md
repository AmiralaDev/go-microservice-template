# Go Microservice Template

<!-- # Hands-On Microservices with Node.js -->

This is the code repository for [Go Microservice Template](https://www.github.com/infranyx/go-grpc-template), published by InfraNyx.

**Build, test, and deploy robust golang microservices**

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Golang Template Project](#golang-template-project)
  - [About the project](#about-the-project)
  - [Prerequisites](#prerequisites)
    - [Design](#design)
    - [Status](#status)
    - [See also](#see-also)
  - [Getting started](#getting-started)
    - [Layout](#layout)
    - [Database Migrations](#database-migrations)
    - [Protocol Buffer](#protocol-buffer)
    - [API docs](#api-docs)
    - [Docker Compose](#docker-compose)
    - [Linting](#linting)
  - [Notes](#notes)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Golang Template Project

## About the project

The template is used to create golang project. All golang projects must follow the conventions in the
template. Calling for exceptions must be brought up in the engineering team.

## Prerequisites

- Go 1.13+

### Design

- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

### Status

The template project is in alpha status.

### See also

- [gRPC](https://grpc.io/) for communication between services
- [SQLx](https://github.com/jmoiron/sqlx) for database access and migrations
- [Redis](github.com/go-redis/redis) for caching and message queues
- [Kafka](https://github.com/segmentio/kafka-go) for streaming data processing
- [Echo](https://echo.labstack.com/) for web server routing
- [Zap Logger](https://github.com/uber-go/zap) for logging
- [Sentry](https://sentry.io/) for error tracking and reporting
- [Cron](https://godoc.org/github.com/robfig/cron) for scheduling tasks
- [errors](https://github.com/pkg/errors) for error handling and adding stack trace to golang
- [OZZO](github.com/go-ozzo/ozzo-validation) for data validation

## Getting started

Below we describe the conventions or tools specific to golang project.

### Layout

```tree
├── .github
│  ├── CODEOWNERS
│  └── pull_request_template.md
├── app
│  └── app.go
├── cmd
│  └── main.go
├── db
│  └── migrations
│    └── time_migrate_name.up.sql
├── envs
│  ├── .env
│  ├── local.env
│  ├── production.env
│  ├── stage.env
│  └── test.env
├── external
│  └── service_name_module
│    ├── domain
│    ├── exception
│    ├── dto
│    └── usecase
├── internal
│  └── module_name
│    ├── configurator
│    ├── delivery
│    │  ├── grpc
│    │  ├── http
│    │  └── kafka
│    │    ├── consumer
│    │    └── producer
│    ├── domain
│    ├── dto
│    ├── exception
│    ├── job
│    ├── repository
│    ├── tests
│    │  ├── fixtures
│    │  └── integrations
│    └── usecase
├── pkg
│  ├── client_container
│  ├── config
│  ├── constant
│  ├── cron
│  ├── env
│  ├── error
│  │  ├── contracts
│  │  ├── custom_error
│  │  ├── error_utils
│  │  ├── grpc
│  │  └── http
│  ├── grpc
│  ├── http
│  ├── infra_container
│  ├── kafka
│  │  ├── consumer
│  │  └── producer
│  ├── logger
│  ├── postgres
│  ├── redis
│  ├── sentry
│  └── wrapper
│
├── .gitignore
├── .pre-commit-config.yaml
├── golangci.yaml
├── docker-compose.e2e-local.yaml
├── docker-compose.yaml
├── go.sum
├── Makefile
├── go.mod
├── LICENSE
└── README.md
```

A brief description of the layout:

- `app` This directory contains the main application file (app.go).
- `cmd` This directory contains the main entry point for the application (main.go).
- `db` This directory contains database migration files that is generated by migrate.
- `envs` This directory contains environment files for different environments.
- `external` This directory contains external service modules and each module can have its own layers like usecase, dto, exceptions, ...
- `internal` This directory contains internal appilication modules and it can have configurator, delivery, domain, dto, exception, job, repository, tests and usecase layers.
- `pkg` This directory contains pre-configured packages for the application.
- `go.*mod/sum`: These files contain go module dependencies information for the project.
- `Makefile`: The Makefile is used to define tasks that can be run from the command line to automate common tasks in a project such as building or testing code.
- `docker-compose*.yaml`: These files contain docker compose configurations for different environments.

### Database Migrations

This code repository use [Migrate](https://github.com/golang-migrate/migrate) as a database migration tool. It helps you manage and keep track of database schema changes in your Go applications.

**Migrate Installation**

To install migrate cli please go to [installation guide](https://github.com/golang-migrate/migrate/blob/master/cmd/migrate/README.md).

**Migratee Usage**

```makefile

migrate-up:   # Target for running 'up' command
 migrate -path db/migrations -database  $(PG_URL) up

migrate-down: # Target for running 'down' command
	migrate -path db/migrations -database $(PG_URL) down

migrate-create: # Target for running 'create'
	migrate create -ext sql -dir db/migrations $(NAME)

migrate-drop: # Target for running 'drop' command
	migrate drop -database $(PG_URL)

migrate-force: # Target for running 'force' command
 migrate -path db/migrations -database $(PG_URL) force $(VERSION)

```

### Protocol Buffer

To use protocol buffer for gRPC communication please refer to [Protohub](https://github.com/infranyx/protobuf-template). Protohub is a hub for managing your protobuf files and with auto generation feature you can simply `go get` the generated code of your proto.

### API docs

The template doesn't have API docs. For auto-generated API docs that you include, you can also give instructions on the
build process.

### Docker Compose

Using Compose is an easy way to manage multi-container applications on any system that supports Docker.

```bash
docker-compose up -d # it runs all necessary docker images that is needed

docker-compose -f docker-compose.e2e-local.yaml up -d # it runs all necessary docker images for Testing environment
```

### Linting

Linting is an important part of any Go project. It helps to ensure that code is written in a consistent and maintainable way, and can help to catch potential errors before they become problems. It is important to note that linting should be done regularly throughout the development process, not just at the end. This will help ensure that any potential issues are caught early on and can be fixed quickly and easily.

To lint your Go project, you can simply use makefile

```makefile
lint-dockerfile: # Lint your Dockerfile

lint-go: # Use golintci-lint on your project
```

## Notes
